{%- style -%}
  .navbar {
    --navbar-padding: 12px;
    --navbar-radius: 24px;
    --navbar-height: 70px;
    --navbar-logo-size: {{ section.settings.logo_width }}px;
    --navbar-bg: rgb(var(--color-background));
    --navbar-text: rgb(var(--color-foreground));
    --navbar-gap: 24px;
    
    display: block;
    width: 100%;
    position: relative;
    z-index: 100;
    padding: 10px 20px;
  }

  .navbar__container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--navbar-padding);
    background: var(--navbar-bg);
    color: var(--navbar-text);
    border-radius: var(--navbar-radius);
    min-height: var(--navbar-height);
    gap: var(--navbar-gap);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    max-width: 1400px;
    margin: 0 auto;
  }

  .navbar__logo {
    display: block;
    width: var(--navbar-logo-size);
    height: var(--navbar-logo-size);
    border-radius: 50%;
    overflow: hidden;
    flex-shrink: 0;
  }

  .navbar__logo img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .navbar__list {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: var(--navbar-gap);
    flex: 1;
    justify-content: center;
  }

  .navbar__item {
    position: relative;
  }

  .navbar__link {
    text-decoration: none;
    color: inherit;
    font-weight: 500;
    padding: 8px 12px;
    border-radius: 8px;
    transition: background-color 0.2s;
  }

  .navbar__link:hover {
    background-color: rgba(var(--color-foreground), 0.05);
  }

  .navbar__submenu {
    position: absolute;
    top: 100%;
    left: 0;
    min-width: 200px;
    background: var(--navbar-bg);
    border-radius: 12px;
    padding: 8px;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    opacity: 0;
    visibility: hidden;
    transform: translateY(10px);
    transition: all 0.2s ease;
    list-style: none;
    z-index: 10;
  }

  .navbar__submenu--active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .navbar__submenu-link {
    display: block;
    padding: 8px 12px;
    text-decoration: none;
    color: inherit;
    border-radius: 6px;
  }

  .navbar__submenu-link:hover {
    background-color: rgba(var(--color-foreground), 0.05);
  }

  .navbar__actions {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .navbar__action-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    color: inherit;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Mobile Styles */
  .navbar__toggle {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    color: inherit;
    display: none;
  }

  .navbar__mobile-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: var(--navbar-bg);
    z-index: 200;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    padding: 24px;
    overflow-y: auto;
  }

  .navbar__mobile-menu--open {
    transform: translateX(0);
  }

  .navbar__mobile-list {
    list-style: none;
    padding: 0;
    margin: 0;
    margin-top: 60px; /* Space for close button */
  }

  .navbar__mobile-item {
    border-bottom: 1px solid rgba(var(--color-foreground), 0.1);
  }

  .navbar__mobile-link {
    display: block;
    padding: 16px 0;
    text-decoration: none;
    color: inherit;
    font-size: 1.2rem;
    font-weight: 600;
  }

  .navbar__mobile-submenu {
    list-style: none;
    padding-left: 16px;
    display: none;
    background: rgba(var(--color-foreground), 0.02);
  }

  .navbar__mobile-submenu--open {
    display: block;
  }

  .navbar__mobile-expand {
    float: right;
    background: none;
    border: none;
    padding: 16px;
    cursor: pointer;
  }

  @media screen and (max-width: 1024px) {
    .navbar__list {
      display: none;
    }
    .navbar__toggle {
      display: block;
    }
    .navbar__logo {
      margin: 0 auto;
    }
  }
{%- endstyle -%}

{%- capture menu_json -%}
[
  {%- if section.settings.menu != blank -%}
    {%- for link in linklists[section.settings.menu].links -%}
      {
        "id": "{{ link.handle }}",
        "label": {{ link.title | json }},
        "url": "{{ link.url }}",
        "children": [
          {%- for child in link.links -%}
            {
              "id": "{{ child.handle }}",
              "label": {{ child.title | json }},
              "url": "{{ child.url }}",
              "children": [
                {%- for grandchild in child.links -%}
                  {
                    "id": "{{ grandchild.handle }}",
                    "label": {{ grandchild.title | json }},
                    "url": "{{ grandchild.url }}"
                  }{%- unless forloop.last -%},{%- endunless -%}
                {%- endfor -%}
              ]
            }{%- unless forloop.last -%},{%- endunless -%}
          {%- endfor -%}
        ]
      }{%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
  {%- endif -%}
]
{%- endcapture -%}

<script src="{{ 'navbar.js' | asset_url }}" type="module" defer fetchpriority="low"></script>

<navbar-component
  class="navbar color-{{ section.settings.color_scheme }}"
  data-menu-data='{{ menu_json | escape }}'
  {{ section.shopify_attributes }}
>
  <div class="navbar__container page-width">
    <!-- Mobile Toggle -->
    <button ref="mobileMenuButton" class="navbar__toggle" aria-label="{{ 'accessibility.menu' | t }}">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>

    <!-- Logo -->
    <a href="{{ routes.root_url }}" class="navbar__logo">
      {%- if settings.logo != blank -%}
        {{ settings.logo | image_url: width: 120 | image_tag: loading: 'eager', width: section.settings.logo_width, height: section.settings.logo_width }}
      {%- else -%}
        <span class="h4">{{ shop.name }}</span>
      {%- endif -%}
    </a>

    <!-- Desktop Menu -->
    <ul ref="navList" class="navbar__list">
      <!-- Populated by JS -->
    </ul>

    <!-- Actions -->
    <div class="navbar__actions">
      {%- if section.settings.show_search -%}
        <a href="{{ routes.search_url }}" class="navbar__action-btn" aria-label="{{ 'general.search.search' | t }}">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </a>
      {%- endif -%}

      {%- if section.settings.show_account and shop.customer_accounts_enabled -%}
        <a href="{{ routes.account_url }}" class="navbar__action-btn" aria-label="{{ 'customer.account.title' | t }}">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </a>
      {%- endif -%}

      {%- if section.settings.show_cart -%}
        <a href="{{ routes.cart_url }}" class="navbar__action-btn" id="cart-icon-bubble" aria-label="{{ 'templates.cart.cart' | t }}">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
          {%- if cart.item_count > 0 -%}
            <div class="cart-count-bubble">
              <span aria-hidden="true">{{ cart.item_count }}</span>
              <span class="visually-hidden">{{ 'sections.header.cart_count' | t: count: cart.item_count }}</span>
            </div>
          {%- endif -%}
        </a>
      {%- endif -%}
    </div>
  </div>

  <!-- Mobile Menu -->
  <div ref="mobileMenu" class="navbar__mobile-menu">
    <button class="navbar__toggle" style="position: absolute; top: 24px; right: 24px;" onclick="this.closest('navbar-component').querySelector('[ref=mobileMenuButton]').click()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    <ul class="navbar__mobile-list">
      <!-- Populated by JS -->
    </ul>
  </div>
</navbar-component>

{% schema %}
{
  "name": "Dynamic Navbar",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menu"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 40,
      "max": 100,
      "step": 2,
      "default": 60,
      "unit": "px",
      "label": "Logo width"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "default": true,
      "label": "Show search"
    },
    {
      "type": "checkbox",
      "id": "show_cart",
      "default": true,
      "label": "Show cart"
    },
    {
      "type": "checkbox",
      "id": "show_wishlist",
      "default": false,
      "label": "Show wishlist"
    },
    {
      "type": "checkbox",
      "id": "show_account",
      "default": true,
      "label": "Show account"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    }
  ],
  "presets": [
    {
      "name": "Dynamic Navbar"
    }
  ]
}
{% endschema %}
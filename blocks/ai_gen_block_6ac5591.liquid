{% doc %}
  @prompt
    slide section, image upload is available  for mobile and website seperately based on best size seperately and will display accordingly, should slide automatically, also on clicking on it, should direct to particular collection or product, should be in modern style no large buttons
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-slider-container-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    overflow: hidden;
    display: block;
  }

  .ai-slider-wrapper-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: {{ block.settings.aspect_ratio_mobile }}%;
  }

  @media screen and (min-width: 750px) {
    .ai-slider-wrapper-{{ ai_gen_id }} {
      padding-bottom: {{ block.settings.aspect_ratio_desktop }}%;
    }
  }

  .ai-slider-track-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .ai-slider-slide-{{ ai_gen_id }} {
    position: relative;
    flex: 0 0 100%;
    width: 100%;
    height: 100%;
  }

  .ai-slider-link-{{ ai_gen_id }} {
    display: block;
    width: 100%;
    height: 100%;
    position: relative;
    cursor: pointer;
  }

  .ai-slider-image-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .ai-slider-image-desktop-{{ ai_gen_id }} {
    display: none;
  }

  @media screen and (min-width: 750px) {
    .ai-slider-image-mobile-{{ ai_gen_id }} {
      display: none;
    }
    .ai-slider-image-desktop-{{ ai_gen_id }} {
      display: block;
    }
  }

  .ai-slider-placeholder-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .ai-slider-placeholder-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
    max-width: 400px;
    max-height: 400px;
  }

  .ai-slider-empty-state-{{ ai_gen_id }} {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 20px;
    font-size: 14px;
    color: #666;
    text-align: center;
    pointer-events: none;
  }

  .ai-slider-nav-{{ ai_gen_id }} {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    z-index: 2;
  }

  .ai-slider-dot-{{ ai_gen_id }} {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: {{ block.settings.dot_color }};
    opacity: 0.4;
    border: none;
    padding: 0;
    cursor: pointer;
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  .ai-slider-dot-{{ ai_gen_id }}:hover {
    opacity: 0.7;
    transform: scale(1.2);
  }

  .ai-slider-dot-{{ ai_gen_id }}.active {
    opacity: 1;
    transform: scale(1.3);
  }
{% endstyle %}

<image-slider-{{ ai_gen_id }}
  class="ai-slider-container-{{ ai_gen_id }}"
  data-autoplay="{{ block.settings.autoplay }}"
  data-interval="{{ block.settings.autoplay_interval }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-slider-wrapper-{{ ai_gen_id }}">
    <div class="ai-slider-track-{{ ai_gen_id }}">
      {% for i in (1..5) %}
        {% liquid
          assign slide_enabled_key = 'slide_' | append: i | append: '_enabled'
          assign desktop_image_key = 'slide_' | append: i | append: '_image_desktop'
          assign mobile_image_key = 'slide_' | append: i | append: '_image_mobile'
          assign link_key = 'slide_' | append: i | append: '_link'

          assign slide_enabled = block.settings[slide_enabled_key]
          assign desktop_image = block.settings[desktop_image_key]
          assign mobile_image = block.settings[mobile_image_key]
          assign link = block.settings[link_key]
        %}

        {% if slide_enabled %}
          <div class="ai-slider-slide-{{ ai_gen_id }}" data-slide-index="{{ forloop.index0 }}">
            {% if link != blank %}
              <a href="{{ link }}" class="ai-slider-link-{{ ai_gen_id }}">
            {% else %}
              <div class="ai-slider-link-{{ ai_gen_id }}">
            {% endif %}

              {% if desktop_image != blank or mobile_image != blank %}
                {% if mobile_image != blank %}
                  <img
                    src="{{ mobile_image | image_url: width: 1500 }}"
                    alt="{{ mobile_image.alt | escape }}"
                    loading="lazy"
                    width="{{ mobile_image.width }}"
                    height="{{ mobile_image.height }}"
                    class="ai-slider-image-{{ ai_gen_id }} ai-slider-image-mobile-{{ ai_gen_id }}"
                  >
                {% endif %}

                {% if desktop_image != blank %}
                  <img
                    src="{{ desktop_image | image_url: width: 2000 }}"
                    alt="{{ desktop_image.alt | escape }}"
                    loading="lazy"
                    width="{{ desktop_image.width }}"
                    height="{{ desktop_image.height }}"
                    class="ai-slider-image-{{ ai_gen_id }} ai-slider-image-desktop-{{ ai_gen_id }}"
                  >
                {% elsif mobile_image != blank %}
                  <img
                    src="{{ mobile_image | image_url: width: 2000 }}"
                    alt="{{ mobile_image.alt | escape }}"
                    loading="lazy"
                    width="{{ mobile_image.width }}"
                    height="{{ mobile_image.height }}"
                    class="ai-slider-image-{{ ai_gen_id }} ai-slider-image-desktop-{{ ai_gen_id }}"
                  >
                {% endif %}
              {% else %}
                <div class="ai-slider-placeholder-{{ ai_gen_id }}">
                  {{ 'hero-apparel-1' | placeholder_svg_tag }}
                  <div class="ai-slider-empty-state-{{ ai_gen_id }}">
                    Add images for slide {{ i }}
                  </div>
                </div>
              {% endif %}

            {% if link != blank %}
              </a>
            {% else %}
              </div>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <div class="ai-slider-nav-{{ ai_gen_id }}">
      {% for i in (1..5) %}
        {% liquid
          assign slide_enabled_key = 'slide_' | append: i | append: '_enabled'
          assign slide_enabled = block.settings[slide_enabled_key]
        %}
        {% if slide_enabled %}
          <button
            class="ai-slider-dot-{{ ai_gen_id }} {% if forloop.index0 == 0 %}active{% endif %}"
            data-slide="{{ forloop.index0 }}"
            aria-label="Go to slide {{ forloop.index }}"
          ></button>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</image-slider-{{ ai_gen_id }}>

<script>
  (function() {
    class ImageSlider{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.currentSlide = 0;
        this.autoplayInterval = null;
      }

      connectedCallback() {
        this.track = this.querySelector('.ai-slider-track-{{ ai_gen_id }}');
        this.slides = this.querySelectorAll('.ai-slider-slide-{{ ai_gen_id }}');
        this.dots = this.querySelectorAll('.ai-slider-dot-{{ ai_gen_id }}');
        this.autoplay = this.dataset.autoplay === 'true';
        this.interval = parseInt(this.dataset.interval) * 1000;

        if (this.slides.length === 0) return;

        this.setupEventListeners();
        
        if (this.autoplay && this.slides.length > 1) {
          this.startAutoplay();
        }
      }

      setupEventListeners() {
        this.dots.forEach((dot) => {
          dot.addEventListener('click', () => {
            const slideIndex = parseInt(dot.dataset.slide);
            this.goToSlide(slideIndex);
            if (this.autoplay) {
              this.resetAutoplay();
            }
          });
        });

        if (this.autoplay) {
          this.addEventListener('mouseenter', () => this.pauseAutoplay());
          this.addEventListener('mouseleave', () => this.startAutoplay());
        }
      }

      goToSlide(index) {
        this.currentSlide = index;
        const offset = -100 * index;
        this.track.style.transform = `translateX(${offset}%)`;

        this.dots.forEach((dot, i) => {
          if (i === index) {
            dot.classList.add('active');
          } else {
            dot.classList.remove('active');
          }
        });
      }

      nextSlide() {
        const nextIndex = (this.currentSlide + 1) % this.slides.length;
        this.goToSlide(nextIndex);
      }

      startAutoplay() {
        if (this.autoplayInterval) return;
        this.autoplayInterval = setInterval(() => {
          this.nextSlide();
        }, this.interval);
      }

      pauseAutoplay() {
        if (this.autoplayInterval) {
          clearInterval(this.autoplayInterval);
          this.autoplayInterval = null;
        }
      }

      resetAutoplay() {
        this.pauseAutoplay();
        this.startAutoplay();
      }

      disconnectedCallback() {
        this.pauseAutoplay();
      }
    }

    customElements.define('image-slider-{{ ai_gen_id }}', ImageSlider{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Image slider",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Slider settings"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-play slides",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_interval",
      "label": "Auto-play interval",
      "min": 2,
      "max": 10,
      "step": 1,
      "unit": "s",
      "default": 5
    },
    {
      "type": "range",
      "id": "aspect_ratio_desktop",
      "label": "Desktop aspect ratio",
      "min": 20,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 40,
      "info": "Height as percentage of width"
    },
    {
      "type": "range",
      "id": "aspect_ratio_mobile",
      "label": "Mobile aspect ratio",
      "min": 50,
      "max": 150,
      "step": 5,
      "unit": "%",
      "default": 100,
      "info": "Height as percentage of width"
    },
    {
      "type": "color",
      "id": "dot_color",
      "label": "Navigation dot color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Slide 1"
    },
    {
      "type": "checkbox",
      "id": "slide_1_enabled",
      "label": "Enable slide 1",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "slide_1_image_desktop",
      "label": "Desktop image"
    },
    {
      "type": "image_picker",
      "id": "slide_1_image_mobile",
      "label": "Mobile image"
    },
    {
      "type": "url",
      "id": "slide_1_link",
      "label": "Link"
    },
    {
      "type": "header",
      "content": "Slide 2"
    },
    {
      "type": "checkbox",
      "id": "slide_2_enabled",
      "label": "Enable slide 2",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "slide_2_image_desktop",
      "label": "Desktop image"
    },
    {
      "type": "image_picker",
      "id": "slide_2_image_mobile",
      "label": "Mobile image"
    },
    {
      "type": "url",
      "id": "slide_2_link",
      "label": "Link"
    },
    {
      "type": "header",
      "content": "Slide 3"
    },
    {
      "type": "checkbox",
      "id": "slide_3_enabled",
      "label": "Enable slide 3",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "slide_3_image_desktop",
      "label": "Desktop image"
    },
    {
      "type": "image_picker",
      "id": "slide_3_image_mobile",
      "label": "Mobile image"
    },
    {
      "type": "url",
      "id": "slide_3_link",
      "label": "Link"
    },
    {
      "type": "header",
      "content": "Slide 4"
    },
    {
      "type": "checkbox",
      "id": "slide_4_enabled",
      "label": "Enable slide 4",
      "default": false
    },
    {
      "type": "image_picker",
      "id": "slide_4_image_desktop",
      "label": "Desktop image"
    },
    {
      "type": "image_picker",
      "id": "slide_4_image_mobile",
      "label": "Mobile image"
    },
    {
      "type": "url",
      "id": "slide_4_link",
      "label": "Link"
    },
    {
      "type": "header",
      "content": "Slide 5"
    },
    {
      "type": "checkbox",
      "id": "slide_5_enabled",
      "label": "Enable slide 5",
      "default": false
    },
    {
      "type": "image_picker",
      "id": "slide_5_image_desktop",
      "label": "Desktop image"
    },
    {
      "type": "image_picker",
      "id": "slide_5_image_mobile",
      "label": "Mobile image"
    },
    {
      "type": "url",
      "id": "slide_5_link",
      "label": "Link"
    }
  ],
  "presets": [
    {
      "name": "Image slider"
    }
  ]
}
{% endschema %}
